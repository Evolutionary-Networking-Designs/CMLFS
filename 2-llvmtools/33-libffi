# Llvmtools Toolchain: libffi 3.3
# Source: ftp://sourceware.org/pub/libffi/libffi-3.3.tar.gz
# Build and install as cmlfs

patch -Np0 -i ../patches/libffi-void/libffi-race-condition.patch &&
patch -Np0 -i ../patches/libffi-void/no-toolexeclibdir.patch

# Configure source with clang
CC=x86_64-pc-linux-musl-clang \
CXX=x86_64-pc-linux-musl-clang++ \
AR=llvm-ar \
AS=llvm-as \
RANLIB=llvm-ranlib \
LD=ld.lld \
STRIP=llvm-strip \
./configure --build=${TARGET_TRUPLE} \
            --host=${TARGET_TRUPLE}  \
            --prefix=/llvmtools      \
            --disable-static \
            --disable-multi-os-directory \
            --with-pic --with-gcc-arch="x86-64"

# Build and install to toolchain
make && make install
