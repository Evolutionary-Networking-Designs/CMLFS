# Llvmtools Chain: Binutils
# Build and install as cmlfs

# Set the environment to cross-compile with binutils & GCC of cgnutools
export CC="${CMLFS_TARGET}-gcc"
export CXX="${CMLFS_TARGET}-g++"
export AR="${CMLFS_TARGET}-ar"
export AS="${CMLFS_TARGET}-as"
export RANLIB="${CMLFS_TARGET}-ranlib"
export LD="${CMLFS_TARGET}-ld"
export STRIP="${CMLFS_TARGET}-strip"

# Link directories so libraries can be found in both lib & lib64
case $(uname -m) in
        x86_64) ln -sv lib /llvmtools/lib64 ;;
esac

# Configure in dedicated build directory
mkdir -v build && cd build
CC_FOR_BUILD="${CMLFS_TARGET}-gcc" \
../configure --prefix=/llvmtools/gnu    \
             --with-lib-path=/llvmtools/gnu/lib \
             --build=${CMLFS_HOST}       \
             --host=${CMLFS_TARGET}      \
             --target=${CMLFS_TARGET}    \
             --disable-nls              \
             --disable-werror           \
             --with-sysroot
# Build
make

# Install
make install

# Clean source to rebuild linker
make -C ld clean

# Build and install linker that will be used later after adjusting toolchain
make -C ld LIB_PATH=/usr/lib:/lib
cp -v ld/ld-new /llvmtools/gnu/bin/
